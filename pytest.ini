[tool:pytest]
# pytest配置文件 - 符合PROJECT_RULES.md规范
# 确保result.log文件被正确生成并包含所有测试日志

markers =
    pytest_compliant: 标记测试为pytest合规性测试
    slow: 标记慢速测试
    integration: 标记集成测试
    unit: 标记单元测试
    contract_compliance: 标记合约合规性相关测试
    e2e: 端到端测试
    smoke: 冒烟测试
    regression: 回归测试

# 日志配置 - 确保完整日志输出到result.log
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] [%(name)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 文件日志配置 - 必须生成result.log
log_file = logs/result.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(name)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# 捕获配置
log_capture = true
log_level = DEBUG

addopts = 
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --cov=.
    --cov-report=term-missing
    --cov-report=html
    --cov-report=json
    --log-file-level=DEBUG
    --log-file=logs/result.log
    --color=yes
    --code-highlight=yes

testpaths = 
    tests

norecursedirs = 
    CHANGESETS
    BACKUPS
    sync_reports
    htmlcov_final
    .git
    __pycache__
    *.egg
    build
    dist

# 排除有问题的测试文件
ignore = 
    tests/test_example.py
    tests/e2e/test_e2e.py
    tests/e2e/test_e2e_system.py
    tests/e2e/test_ops_system.py
    tests/unit/test_field_usage_analysis.py

python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

filterwarnings =
    ignore::pytest.PytestUnknownMarkWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning

# 最小Python版本要求
minversion = 6.0

# 超时配置（秒）
timeout = 300

# 严格模式配置
xfail_strict = true

# 控制台输出格式
console_output_style = progress